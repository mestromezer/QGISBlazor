@page "/create"
@using System.Text;
@using NetTopologySuite.Geometries;
@using Newtonsoft.Json
@using QGISBlazorWebAssemblyApplication.Models;
@inject IConfiguration configuration
@inject NavigationManager navigationManager
@inject HttpClient client
@inject ILogger<Create> logger

<h1>Создать запись в таблице "Buildings".</h1>

<EditForm Model="@Model" class="row">
    <div class="row">
        <label class="col">Геометрия: </label>
        <InputTextArea @bind-Value="geometry" class="col" />
    </div>

    <div class="row">
        <label class="col">Адрес: </label>
        <InputText @bind-Value="Model.Address" class="col" />
    </div>

    <button @onclick="Send" type="submit">Submit</button>
</EditForm>

@code {
    private Building Model { get; set; } = new Building();
    private string geometry { get; set; }
    private async void Send()
    {
       
        Model.Geom = JsonProcessor<Geometry>.Parse(geometry);
        var request = new HttpRequestMessage(HttpMethod.Post, configuration["apiUrl"]);
        request.Content = new StringContent(
            JsonProcessor<Building>.ConvertToGeoJson(Model), 
            Encoding.UTF8,
            "application/json");
        try
        {
            var response = await client.SendAsync(request);
            logger.LogInformation($"POST response status: {response.StatusCode}");
        }
        catch (Exception ex)
        {
            logger.LogError("POST page Send method occured error");
            logger.LogError(ex.Message);
            throw ex;
        }
        navigationManager.NavigateTo("/");
    }
}
